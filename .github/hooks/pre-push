#!/bin/bash
# INFO: THIS PRE-PUSH HOOK WILL PREVENT A RELEASE COMMIT TO BE PUSHED
# IF THE `yarn build` COMMAND CAN'T RUN SUCCESSFULLY

# Function to check if the commit message starts with "release"
check_release_commit() {
    commit_msg=$(git log -1 --pretty=%B)
    if [[ $commit_msg == release* ]]; then
        return 0
    else
        return 1
    fi
}

# Function to run yarn build
run_yarn_build() {
    echo "Running yarn build..."
    yarn build
    build_exit_code=$?
    
    if [ $build_exit_code -ne 0 ]; then
        echo "Error: 'yarn build' failed. Push aborted."
        exit 1
    else
        echo "'yarn build' completed successfully."
    fi
}

# Main logic
if check_release_commit; then
    echo "Commit message starts with 'release'. Checking build..."
    run_yarn_build
else
    echo "Commit message doesn't start with 'release'. Skipping build check."
fi

exit 0